<!DOCTYPE html>
<!-- _layouts/distill.html -->
<html>
    
<head>    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bumjini | 📌 Early Experiments on Sparse Autoencoding (SAE)</title>
    <meta name="author" content="Bumjini  " />
    <meta name="description" content="신경망의 표현에 숨어있는 수많은 특징들을 찾아내기 위해서 최근 연구되는 SAE 기법을 추종하기 위해 실험을 진행하였다. " />
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🪴</text></svg>">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://fxnnxc.github.io/study/240429_sparse_autoencoding/">
    
    <!-- Dark Mode -->
    

  <!-- jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams',
        inlineMath: [['$','$'], ['\\(','\\)']]
      },
      chtml: {
          scale: 1.0,
          minScale: .6,  
          mtextFontInherit: true,
          mtextInheritFont: true,
          merrorInheritFont: true,
        },
        svg: {
          scale: 1.2
        }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

  <!-- Distill js -->
  <script src="/assets/js/distillpub/template.v2.js"></script>
  <script src="/assets/js/distillpub/transforms.v2.js"></script>
  <script src="/assets/js/distillpub/overrides.js"></script>
  <!-- Page/Post style -->
  
</head>

  <d-front-matter>
    <script async type="text/json">{
      "title": "📌 Early Experiments on Sparse Autoencoding (SAE)",
      "description": "신경망의 표현에 숨어있는 수많은 특징들을 찾아내기 위해서 최근 연구되는 SAE 기법을 추종하기 위해 실험을 진행하였다. ",
      "published": "April 29, 2024",
      "authors": [
        {
          "author": "Bumjin Park",
          "authorURL": "",
          "affiliations": [
            {
              "name": "KAIST",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  <body style="padding-top:0px" class="sticky-bottom-footer"> 
    
    <!-- Header --><header>
      
      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm sticky-top">
        <div class="container">
          <img>
          <!-- <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;"> -->
          
          <a class="navbar-brand title font-weight-lighter" href="https://fxnnxc.github.io/" style="margin-left:20px ;">
              <!--Bumjini-->
           <span class="font-weight-bold" style="font-size:larger;font-family:Times New Roman;">Bumjini    </span>
        </a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <!-- <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/">  About Me</a>
              </li> -->
              
              <!-- Blog -->
              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_papers/"> Papers</a>
              </li>

              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_articles/"> Articles</a>
              </li>

              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_projects/"> Projects</a>
              </li>

              <!-- Other pages -->
              <li style="font-size: 17px" class="nav-item dropdown ">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Others</a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/side_papers/">🗂️ side-paper</a>
                  <a class="dropdown-item" href="/side_articles/">🥕 side-articles</a>
                  <a class="dropdown-item" href="/book/">📚 book (korean)</a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1 style="font-size: 32px;">📌 Early Experiments on Sparse Autoencoding (SAE)</h1>
        <p>신경망의 표현에 숨어있는 수많은 특징들을 찾아내기 위해서 최근 연구되는 SAE 기법을 추종하기 위해 실험을 진행하였다. </p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        

        <p>모델의 표현을 해석한다는 것은 특정 액티베이션 패턴이 지니는 의미를 데이터와 연결 짓는 것이다. 최근 알려진 바에 따르면 모델이 특징을 저장하기 위해서 복수 개의 뉴런이 특정 패턴을 만들어서 저장한다는 것이 알려졌다. 이 사실은 기존에 binary적인 뉴런의 켜지고 꺼지는 현상으로 특징의 유무를 판단했던 것을 넘어서 특정 액티베이션 패턴이 의미를 지닌다는 사실을 나타낸다. 축약된 차원에 저장된 무수히 많은 특징을 찾기 위해서 연구자들이 사용하는 방식은 dictionary learning이다. 특징인 패턴을 집어넣고, 다시 복원하는 간단한 문제에서 내부에 무수히 많은 feature들을 저장하고 선택하는 방식은, 그들의 linear sum이 신경망의 특징을 나타낸다는 가정을 보인다.</p>

<p>나는 이 연구를 추종하기 위해서 코드를 구현하고 실험하였다. Wikipedia 10만개 문서에 대해서 Llama2의 activation을 수집하여 SAE 학습을 진행하였다. 
이 부분은 그 길에서 가장 간단한 구조로부터 무엇이 잘되고 안되는지 파악하기 위한 연구였다. 실험 결과, 모델의 층이 높아질수록 Reconstruction이 제대로 일어나지 않았고, GatedSAE는 더 낮은 성능을 보였다. 이는 Neuron Resampling기법을 적용하지 않았기 때문에 그런 것이다.</p>

<ul>
  <li>🧑🏻‍💻 Code Implementation [<a href="https://github.com/fxnnxc/llm/tree/v24.05.05_SAE" target="_blank" rel="noopener noreferrer">Github</a>]</li>
  <li>🧑🏻‍💻 PseudoCode Implementation [<a href="https://gist.github.com/fxnnxc/35a72b2af899a6f339bb9d2aa09ab563" target="_blank" rel="noopener noreferrer">Gist</a>]</li>
</ul>

<h2 id="아키텍처">아키텍처</h2>

<h3 id="saes">SAEs</h3>
<p>\(f(x) = ReLU(W_{enc} (x- b_{dec}) + b_{enc}) \\ 
\hat{x}(f) = W_{dec}f + b_{dec}\)</p>

\[L(x) =  || x - \hat{x}(f(x)) ||_2^2  + \lambda ||f(x)||_1\]

<h3 id="gated-saes">Gated SAEs</h3>

\[\hat{f}(x) = 1[W_{gate}(x-b_{dec} +b_{gate}) &gt;0] \odot ReLU(W_{mag} (x- b_{dec}) + b_{mag})\]

<p>where $1[\cdot &gt;0]$ is the pointwise Heavyside step function and $\odot$ denotes elementwise multiplication. 
To reduce the number of weights, the authors set the weight
\((W_{mag})_{ij} =  (\exp(r_{mag}))_i \cdot (W_{gate})_{ij}\)
where $r_{mag} \in \mathbb{R}^M$ is the rescaling parameter.</p>

\[L_{incorrect}(x) = L(x) =  || x - \hat{x}(f(x)) ||_2^2  + \lambda ||f_{gate}(x)||_1\]

<h2 id="평가">평가</h2>

<h3 id="1-reconstruction">1. Reconstruction</h3>

<p>표현을 Dictionary learning으로 결합하였을 때 복원력</p>

\[\Vert x - \hat{x}(f(x)) \Vert_2^2\]

<h3 id="2-l0">2. L0</h3>
<p>표현을 Dictionary learning으로 결합하였을 때 복원력에 필요했던 아이템 개수</p>

<p>L0 be the number of non zero features</p>

\[L0 = \mathbb{E}_{X\sim D} \Vert f(x)\Vert_0\]

<h3 id="3-loss-recovered">3. loss recovered</h3>

<p>표현을 Dictionary learning으로 결합하였을 때 복원력 (모델 성능 기반)</p>

\[1 - \frac{CE(\hat{x} \cdot \hat{f}) - CE(ID)}{CE(\psi) - CE(ID)}\]

<p>where</p>
<ul>
  <li>$x \mapsto x$ :  the identity function, $\psi: x \mapsto 0$ the zero-ablation and $\hat{x} \cdot \hat{f}$ is autoencoder.</li>
  <li>When the ID is recovered with SAE, the score is 1.</li>
</ul>

<h2 id="데이터">데이터</h2>

<ul>
  <li>LLama2 Activations</li>
  <li>Layers: 2, middle, -2  (early, and later)</li>
  <li>Wikipedia: 100,000개. (from fever dataset)</li>
</ul>

<hr>

<h2 id="초기-실험-결과">초기 실험 결과</h2>

<ol>
  <li>lr_scheduler: <code class="language-plaintext highlighter-rouge">cosine hard restart</code>를 사용하는 경우, 학습에 효과가 좋지 않다.</li>
  <li>gatedSAE의 경우, SAE보다 성능이 좋지 않다. (논문에서는 Neuron Resampling을 하였다고 한다. 이 부분이 성능 차이를 보인 것으로 보인다. 왜냐하면, gate가 켜지는 경우, gate에 Bias가 되기 때문이다. )</li>
  <li>early, middle, later에 대해서 앞의 두 개는 학습이 제대로 되었지만, 마지막은 학습되지 않았다.</li>
  <li>L1 coefficient는 하는 만큼 Reconstruction에 영향을 미친다.</li>
</ol>

<p><img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%218851&amp;authkey=%21ABvIo6RPLoT1Oao&amp;width=746&amp;height=578" width="746" height="578"></p>

<h3 id="왜-레이어가-올라갈수록-reconstruction은-되지-않는가">왜 레이어가 올라갈수록 Reconstruction은 되지 않는가?</h3>

<p>특징이라는 것은 결정적이고, 고정적인 성질을 지녀야 한다. 다음과 같은 사고 실험을 생각해보자.</p>

<ol>
  <li>레고를 여러 개 보여준다. (input batch)</li>
  <li>레고를 구성하는 컴포넌트들을 고르라고 한다. (items)</li>
  <li>컴포넌트들을 결함하여 각 레고들을 모두 복원하라고 한다 (selection)</li>
  <li>원래 레고들과 각각 비교한다. (reconstruction)</li>
</ol>

<p>전체 과정에서 2, 3번은 딥러닝의 End-to-End 학습을 통해서 적절한 Item 표현과 selection을 찾는 과정이다. 
그 과정에서 Item의 표현이 적절하지 않거나 selection부분이 적절하지 않을 수 있다.</p>

<p>레이어가 높아질수록 학습되지 않았던 것은 두 가지 모두 영향을 끼치는 것으로 확인된다. 
즉, 레이어가 올라가면서 다음 문제가 생긴다.</p>

<blockquote>
복잡한 레이어의 표현공간에 대해서 적절한 <strong>Primitive component</strong>를 찾을 수 있는가? (No)
</blockquote>

      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

<!--
    </div>
 -->
      <hr>
<!-- Footer -->    <footer class="sticky-bottom mt-5" style="border: none;border-top:0px">
      <div class="container" style="text-align: center; ">
        © Copyright 2024 Bumjini  . Powered by Jekyll with al-folio theme. Hosted by GitHub Pages.

      </div>
    </footer>
    
    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": 0 });
    $("progress-container").css({ "padding-top": 0 });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>
  </div></body>
  
  <d-bibliography src="/assets/bibliography/all.bib">
  </d-bibliography>
  <script src="/assets/js/distillpub/overrides.js"></script>

  <center>
    <a  href="">
    <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;">
    </a>
  </center>
  <hr> 

  </html>
