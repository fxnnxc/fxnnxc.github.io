<!DOCTYPE html>
<!-- _layouts/distill.html -->
<html>
    
<head>    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bumjini | 문서 메모리 방식은 document memorization으로 Factuality에 대해서 높은 성능을 낼 수 있는가? (Korean)</title>
    <meta name="author" content="Bumjini  " />
    <meta name="description" content="문서를 암기하도록 저장하는 것은 도움이 된다. 추가적인 궁금증은 구조적인 메모리로 문서를 암기하는 것이 도움이 되는지 여부이다." />
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🪴</text></svg>">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://fxnnxc.github.io/study/240415_document_wise_memory_simset/">
    
    <!-- Dark Mode -->
    

  <!-- jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams',
        inlineMath: [['$','$'], ['\\(','\\)']]
      },
      chtml: {
          scale: 1.0,
          minScale: .6,  
          mtextFontInherit: true,
          mtextInheritFont: true,
          merrorInheritFont: true,
        },
        svg: {
          scale: 1.2
        }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

  <!-- Distill js -->
  <script src="/assets/js/distillpub/template.v2.js"></script>
  <script src="/assets/js/distillpub/transforms.v2.js"></script>
  <script src="/assets/js/distillpub/overrides.js"></script>
  <!-- Page/Post style -->
  
</head>

  <d-front-matter>
    <script async type="text/json">{
      "title": "문서 메모리 방식은 document memorization으로 Factuality에 대해서 높은 성능을 낼 수 있는가? (Korean)",
      "description": "문서를 암기하도록 저장하는 것은 도움이 된다. 추가적인 궁금증은 구조적인 메모리로 문서를 암기하는 것이 도움이 되는지 여부이다.",
      "published": "April 14, 2024",
      "authors": [
        {
          "author": "Bumjin Park",
          "authorURL": "",
          "affiliations": [
            {
              "name": "KAIST",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  <body style="padding-top:0px" class="sticky-bottom-footer"> 
    
    <!-- Header --><header>
      
      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm sticky-top">
        <div class="container">
          <img>
          <!-- <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;"> -->
          
          <a class="navbar-brand title font-weight-lighter" href="https://fxnnxc.github.io/" style="margin-left:20px ;">
              <!--Bumjini-->
           <span class="font-weight-bold" style="font-size:larger;font-family:Times New Roman;">Bumjini    </span>
        </a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <!-- <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/">  About Me</a>
              </li> -->
              
              <!-- Blog -->
              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_papers/"> Papers</a>
              </li>

              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_articles/"> Articles</a>
              </li>

              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_projects/"> Projects</a>
              </li>

              <!-- Other pages -->
              <li style="font-size: 17px" class="nav-item dropdown ">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Others</a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/side_papers/">🗂️ side-paper</a>
                  <a class="dropdown-item" href="/side_articles/">🥕 side-articles</a>
                  <a class="dropdown-item" href="/book/">📚 book (korean)</a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1 style="font-size: 32px;">문서 메모리 방식은 document memorization으로 Factuality에 대해서 높은 성능을 낼 수 있는가? (Korean)</h1>
        <p>문서를 암기하도록 저장하는 것은 도움이 된다. 추가적인 궁금증은 구조적인 메모리로 문서를 암기하는 것이 도움이 되는지 여부이다.</p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        

        <h2 id="does-structural-document-memory-help-factual-recall">Does Structural Document Memory Help Factual Recall?</h2>

<ul>
  <li>🗓️ <strong>Experiment Date</strong> : 24.04.08</li>
  <li>🌸 <strong>Scope</strong> : Few-shot classification for large language models with memorization adaptation. We use FEVER dataset 449 pages and related validation question <br> (#samples: valid 18999 train 311431).</li>
  <li>🧑🏻‍💻 <strong>Code</strong>:<a href="">TBW</a>
</li>
  <li>😮 <strong>Status</strong> : Running Experiments
    <ul class="task-list">
      <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>  <em>Documentation of Settings</em>
</li>
      <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>  <em>Implementation of Codes</em>
</li>
      <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>  <em>Running Experiments</em>
</li>
      <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>  <em>Record Results</em>
</li>
      <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>  <em>Analysis Results</em>
</li>
    </ul>
  </li>
</ul>

<h2 id="document-wise-memories">Document-wise Memories</h2>

<p>문서에 대한 메모리를 설정하는 것은 지식을 더욱 정렬하는 효과를 불러일으킨다.
이 연구에서는 동일한 파라미터에 대해서 문서별 메모리를 설정하는 것이 비슷한 문서 암기 수준을 보인다는 점을 밝힌다. 
그러나, Factuality Question Answering에 대해서는 문서에 저장된 정보를 제대로 활용하지 못한다고 생각한다.</p>

<p>몇 개의 레이어에서는 축자ㅓㄱ인 학습 없이도 문서의 메모리를</p>

<h2 id="experimental-settings">Experimental Settings</h2>

<p>We use the same setting in <a href="https://fxnnxc.github.io/study/240328_fever_neural_memory/">the previous work</a> except the number of documents to 449 pages. 
We do not train the template for fever training dataset and directly evaluate the validation question and answer pairs by memorizing the evidence Wiki pages. 
We use Llama2 7B and  Llama2-Chat 7B for the memorization of documents. All the predictions are conducted with 1-shot setting where the few-shot examples are obtained from the training QA pairs of the same document.</p>

<h3 id="baselines-and-simset">Baselines and SimSet</h3>

<p>We use the following baselines for the experiment and evaluate the performance of SimSet structural memories for documents.</p>

<ol>
  <li>Pretrained Status</li>
  <li>Unstructured Neural Memory</li>
  <li>Structured with Disjoint Length Proportional</li>
</ol>

<p>We use the following Simset settings</p>
<ol>
  <li>1-shingling</li>
  <li>2-shingling</li>
</ol>

<p>⚠️ 해당 결과는 memory 와 simset의 메모리 구조가 다르다. memory 는 layer_norm 과 gating을 추가로 사용하였다.</p>

<p>해당 결과는 <a href="https://github.com/fxnnxc/llm/commit/7e98fdbda22c250dd4d8d5a16ae26c18d3ea7664#diff-11b35a9339f1d97e709083bb0f43c9a7c1e06b9ab5afc67e935785175f147c36" target="_blank" rel="noopener noreferrer">코드실수</a>로 결과가 맞지 않다. 
메모리는 문서에 대해서 학습한 게 맞지만, Simset은 FEVER template에 대해서 학습하였다. 따라서, Simset은 메모리별로 문서 정보가 아니라 FEVER 학습 데이터로 업데이트 되었다.</p>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Pretrained Weights</th>
      <th>Memory (24th)</th>
      <th>1-shin (24th-dim)</th>
      <th>1-shin (24th-token)</th>
      <th>2-shin (24th-dim)</th>
      <th>2-shin (24th-token)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>llama2_chat 7b</td>
      <td>0.644</td>
      <td>0.652</td>
      <td>0.640 (template)</td>
      <td>0.641 (template)</td>
      <td>0.640 (template)</td>
      <td>0.653 (template)</td>
    </tr>
    <tr>
      <td>layernorm+gate</td>
      <td>0.644</td>
      <td>0.652</td>
      <td>0.649 (template)</td>
      <td>0.641(template)</td>
      <td>0.639 (template)</td>
      <td>0.653 (template)</td>
    </tr>
    <tr>
      <td>document memo.</td>
      <td>0.644</td>
      <td>0.652</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h4 id="문서-암기-학습-에러">문서 암기 학습 에러</h4>

<p>학습 시간 및 레이어에 따른 에러는 다음과 같다. 마지막 레이어에 가까워질수록 loss와 가깝기 때문에 더 낮은 에러에서 시작한다. 그러나 학습이 오래 진행될수록 일반화 성능은 떨어지는 것을 확인할 수 있다. 
중간 레이어를 수정하는 것은 모델의 state에 대해서 수정하기 때문에 장기적으로 봤을 때 에러가 더 낮은 것으로 보인다. 따라서 중간 레이어에 대해서 추가 메모리 구조를 적용하는 것은 <strong>GPT 내부 state에 대한 변화를 주는 것이다.</strong></p>

<p><img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%211520&amp;authkey=%21ANxTllKjra8N740&amp;width=716&amp;height=726" width="500" height="300" style="width:49%">
<img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%211521&amp;authkey=%21AASIkNN2b464Wsw&amp;width=704&amp;height=700" width="500" height="300" style="width:49%"></p>

<h4 id="fever-정확도">FEVER 정확도</h4>

<p>각 레이어에 대해서 추가적인 모듈을 학습하는 경우 다음과 같은 정확도를 가진다. Pretrained는 모델에 다른 작업 없이 1-shot으로 예측하는 결과이다. 
대부분의 레어어들은 모델에 adaptation하는 것이 오히려 성능 저하를 가져왔다. 반면 특정 
<img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%211535&amp;authkey=%21AIp4mtZQFFSnv5g&amp;width=660" width="660" height="auto" style="border:#000000 solid 2px"></p>

<p>레이어, 문서 암기 에러, Factual Knowledge 정확도는 다음과 같다.
<img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%211522&amp;authkey=%21AL3pl1mGWgMZoFk&amp;height=660" width="auto" height="660"></p>

<h2 id="no-clear-sign-of-benefits-of-simset">No Clear Sign of Benefits of SimSet</h2>

<p>그냥 메모리에 저장하는 것은 모델이 알아서 사용하도록 큰 도움을 주는가? 내가 표현을 적절하게 바꿔주는가? 그렇지 않은 것 같다. 
일부 모델링에서 약간의 성능 향상이 있지만, 유의미한 수준이 아니며, 일반적으로는 성능 저하가 나타나는 것으로 보인다. 
따라서, 지식을 저장하는 것과 LLM이 저장된 지식 표현을 효율적으로 사용하는 것을 보장하지 않는다.</p>

<p><img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%211534&amp;authkey=%21AK-qxNrFwF--dUw&amp;width=874&amp;height=729" width="874" height="729"></p>

<p>SimSet-Dimension의 경우 Loss 자체는 높은 수준을 보였기에 저장이 제대로 되지 않았다고 할 수 있다. 그러나, Accuracy 자체는 더 높게 나타났기에 저장이 잘 된다고, 혹은 유의미하게 된다고 
다른 Task에 모델이 바로 사용가능하다는 것은 틀렸다. 모델이 저장된 지식을 예측에 사용하게 만들기 위해서 적절한 모델링이 추가적으로 연구되어야 한다.</p>

<p><img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%211536&amp;authkey=%21AFRTiDkjsX7FQHo&amp;width=874&amp;height=571" width="874" height="571"></p>

<ul>
  <li>문서 암기를 추가적으로 하는 것은 몇몇 레이어에서 Fever 데이터에 대한 정확도를 증가시켰다. 그러나 일반적으로 모든 레이어에서 오르지 않으며, 구조적으로 설계된 메모리가 정확도를 올리지 않는다.</li>
</ul>

<h2 id="analysis">Analysis</h2>

<p>저장은 잘 되는 것 같다. 그러나 저장된 정보를 잘 활용하는지는 여전히 미지수로 남아있다. 
이 정보를 활용하는 것을 추가적으로 학습하기 위해서도 어뎁테이션 학습이 가능하다. 따라서 만일 Simset이 별다른 추가 학습 없이 메모리를 효율적으로 사용할 수 있다면, 해당 메모리를 더욱 사용하도록 추가학습하는 것이 도움이 될 것이다.</p>

<p>단순하게 저장하는 것이 도움이 된다는 점은 naive 하다. 추가적으로 저장된 정보를 활용하는 방법을 연구해야 한다.  저장 자체만으로는 부족하다. 
정보 저장의 관점에서는 전체 메모리를 사용하는 것과 동일한 수준으로 암기력을 보이고 있다. 그러나 해당 정보가 실제로 더욱 도움이 되는지는 아직 부족하다. 
따라서, Neural 메모리의 효율을 올리기 위한 구조적인, 알고리즘적인 방법을 찾아야 한다.</p>

<hr>

<h2 id="update-on-240416">Update on 240416</h2>

<h3 id="코드-오류-발생">코드 오류 발생!</h3>

<p>FEVER 학습 데이터에 대해서 Layer-norm과 gating을 추가하는 경우, Simset-1에 대해서 성능이 향상되었다.  SimSet2에 대해서는 성능이 저하되었다. 
학습 다이나믹은 Simset의 경우, Template에 대한 다니아믹, Memory는 문서 학습에 대한 다이나믹이라서 큰 차이를 보인다. 
<img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%211554&amp;authkey=%21ALv2uupMChkiWQ4&amp;width=867&amp;height=570" width="867" height="570">
<img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%211555&amp;authkey=%21APA0p3_k7nNOeHI&amp;width=887&amp;height=726" width="887" height="726"></p>

<h3 id="문서에-대해서-재학습">문서에 대해서 재학습</h3>

<h3 id="문서--adaptation-에-대해서-재학습">문서 + Adaptation 에 대해서 재학습</h3>


      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

<!--
    </div>
 -->
      <hr>
<!-- Footer -->    <footer class="sticky-bottom mt-5" style="border: none;border-top:0px">
      <div class="container" style="text-align: center; ">
        © Copyright 2024 Bumjini  . Powered by Jekyll with al-folio theme. Hosted by GitHub Pages.

      </div>
    </footer>
    
    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": 0 });
    $("progress-container").css({ "padding-top": 0 });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>
  </div></body>
  
  <d-bibliography src="/assets/bibliography/all.bib">
  </d-bibliography>
  <script src="/assets/js/distillpub/overrides.js"></script>

  <center>
    <a  href="">
    <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;">
    </a>
  </center>
  <hr> 

  </html>
