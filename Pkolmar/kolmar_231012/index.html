<!DOCTYPE html>
<!-- _layouts/distill.html -->
<html>
  <head>    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bumjini | [연구 3] Decision Tree & SVR</title>
    <meta name="author" content="Bumjini  " />
    <meta name="description" content="First Receipt 데이터 머신러닝을 활용한 점도 예측" />
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🪴</text></svg>">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://fxnnxc.github.io/Pkolmar/kolmar_231012/">
    
    <!-- Dark Mode -->
    


    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams',
        inlineMath: [['$','$'], ['\\(','\\)']]
      },
      chtml: {
          scale: 1.0,
          minScale: .6,  
          mtextFontInherit: true,
          mtextInheritFont: true,
          merrorInheritFont: true,
        },
        svg: {
          scale: 1.2
        }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Distill js -->
    <script src="/assets/js/distillpub/template.v2.js"></script>
    <script src="/assets/js/distillpub/transforms.v2.js"></script>
    
  </head>

  <d-front-matter>
    <script async type="text/json">{
      "title": "[연구 3] Decision Tree & SVR",
      "description": "First Receipt 데이터 머신러닝을 활용한 점도 예측",
      "published": "October 8, 2023",
      "authors": [
        {
          "author": "Bumjin Park",
          "authorURL": "",
          "affiliations": [
            {
              "name": "KAIST",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  <body class="sticky-bottom-footer">

    <!-- Header -->    
    <center>
      <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;">
    </center>
    <hr> 

    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1 style="font-size: 32px;">[연구 3] Decision Tree &amp; SVR</h1>
        <p>First Receipt 데이터 머신러닝을 활용한 점도 예측</p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        

        <h2 id="1-report-info">1. Report Info</h2>

<p>본 글에서는 <code class="language-plaintext highlighter-rouge">first_receipt</code> 에 대해서 Regression 모델 두 가지를 학습하여, 성능 비교를 진행한다. 
머신러닝 모델로 학습해본 결과 단순 Decision Tree 기반 모델은 제대로 예측할 수 없음을 확인하였다. 이는 Regression 예측이 샘플에 대한 평균값을 사용하는데, 노드 수가 적기 때문에 예측의 범위가 중앙에 올려있는 경우가 많다. 이와는 반대로 입력값에 회기식을 만들어서 예측하는 Support Vector Regression 모델은 성능이 보장되는 것을 확인하였다. 코드 개수에 대해서는 코드가 늘어날수록 SVR 은 학습/테스트 데이터 모두 성능이 향상되었지만, DT 모델은 성능이 향상되지 않았고, 트리의 깊이도 더욱 증가하지 않았다. 따라서, Regression 기반 Decision Tree는 부적합한 것을 확인하였고, 더욱 복잡한 Tree 형태를 고려할 계획이다.</p>

<p>한 가지 아쉬운 점은 Tree 기반 모델의 해석의 유용성을 접목하는 것이다. 이를 위해서 Classification 기반 모델에 대해서 Tree 를 적용해야 하는데, 레이블을 5000단위로 생성할 경우 20개 정도의 레이블이 생기므로 단순 Decision Tree Classification으로도 성능을 내기 어려울 것으로 판단된다. 복잡한 Tree인 Random Forest 나 XGBoost 의 형태를 고려할 계획이다.</p>

<div class="spanbox" style="width:40rem;background-color:#FFFDFD;">
  <ol>
    <li>👨🏻‍💻 <strong>Code Release</strong>:  Tag <a href="https://github.com/fxnnxc/kolmar/tree/v23.10.12.2" target="_blank" rel="noopener noreferrer">v23.10.12.2</a>
</li>
    <li>📂 <strong>Raw Data</strong> :  (1, <code class="language-plaintext highlighter-rouge">raw_data:first_receipt</code>)</li>
    <li>🗂️ <strong>Datasets</strong> :  (2, <code class="language-plaintext highlighter-rouge">ds:first_receipt_ml</code>)</li>
    <li>👾 <strong>Models</strong> :  (0, ‘<code class="language-plaintext highlighter-rouge">decision_tree_regressor</code>’) / (1, <code class="language-plaintext highlighter-rouge">svr</code>)</li>
    <li>🦄 <strong>Trainers</strong> : (1, <code class="language-plaintext highlighter-rouge">sklearn_regressor</code>)</li>
    <li>📌 <strong>Related Notebooks</strong>
      <ul>
        <li><a href="https://github.com/fxnnxc/kolmar/blob/v23.10.12.1/labs/first_receipt_rmse/plot_rmse_svr.ipynb" target="_blank" rel="noopener noreferrer">svr_rmse.ipynb</a></li>
        <li><a href="https://github.com/fxnnxc/kolmar/blob/v23.10.12.1/labs/first_receipt_rmse/plot_rmse_tree.ipynb" target="_blank" rel="noopener noreferrer">dt_rmse.ipynb</a></li>
      </ul>
    </li>
  </ol>
</div>

<h2 id="2-학습-결과">2. 학습 결과</h2>
<ul>
  <li>학습 모델은 두 가지 Support Vector Regressor (SVR) 과 Decision Tree Regressor (DT)</li>
  <li>예측 값은 1/10000 값으로 낮춰서 예측한다.</li>
</ul>

<h2 id="21-training-rmse-root-mean-squared-error">2.1. Training RMSE (Root Mean Squared Error)</h2>

<div class="spanbox" style="width:100%">

  <ul>
    <li>MSE : mean squared error</li>
    <li>RMSE : root mean squared error</li>
  </ul>

\[MSE = \frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2\]

\[RMSE = \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2}\]

  <p>아래 그림은 입력에 사용된 코드 개수에 따라서 성능을 보여준다. (좌: SVR, 우:DT)</p>

  <p><img src="https://drive.google.com/uc?export=view&amp;id=10-vwD_CzikpZFPvHji2Qs-EP-m8jb5TY" style="width:49%">
<img src="https://drive.google.com/uc?export=view&amp;id=1vbVyGzec2w298efKHKNzHVmOace7Wtdl" style="width:49%"></p>
</div>

<hr>

<h2 id="22-parameter-search">2.2. Parameter Search</h2>

<div class="spanbox" style="width:100%">

  <p>여러 파라미터 중에서 최적의 파라미터를 찾는다.</p>

  <h3 id="decision-tree">2.2.1 Decision Tree</h3>

  <d-code language="python">
param_grid = {
                    "splitter":["best","random"],
                    'max_depth': [1,2,3,5,7,9],
                    'min_samples_split': [2, 3, 4, 5, 10],
                    "min_weight_fraction_leaf":[0.1, 0.3, 0.5],
                    "max_features":["log2", "sqrt"],
                    "max_leaf_nodes":[None,10, 20, 30, 50, 100]
                    }
</d-code>

  <ul>
    <li>Decision Tree : ‘max_depth’</li>
  </ul>

  <p><img src="https://drive.google.com/uc?export=view&amp;id=1rbjPF06wY8xkaIQfF2l-qW2XByNETeLp" style="width:100%"></p>

  <h4 id="section">예시) 코드 100 개 모델</h4>

  <p>학습 완료 후, 학습된 모델의 정보를 보면 다음과 같다.</p>

  <d-code language="python">

best_params:
  max_depth: 7
  max_features: sqrt
  max_leaf_nodes: null
  min_samples_split: 2
  min_weight_fraction_leaf: 0.1
  splitter: random
train_results:
  rmse: 1.2203531353731971
test_results:
  rmse: 1.2753255313844698

|--- GYH026 &lt;= 4.52
|   |--- HJK244 &lt;= 0.55
|   |   |--- FGH202 &lt;= 2.84
|   |   |   |--- CVB114 &lt;= 0.57
|   |   |   |   |--- XCV072 &lt;= 3.86
|   |   |   |   |   |--- value: [5.10]
|   |   |   |   |--- XCV072 &gt;  3.86
|   |   |   |   |   |--- value: [5.46]
|   |   |   |--- CVB114 &gt;  0.57
|   |   |   |   |--- value: [4.88]
|   |   |--- FGH202 &gt;  2.84
|   |   |   |--- value: [4.76]
|   |--- HJK244 &gt;  0.55
|   |   |--- value: [4.09]
|--- GYH026 &gt;  4.52
|   |--- value: [5.87]

</d-code>

  <hr>

  <p><img src="https://drive.google.com/uc?export=view&amp;id=1mtE_2yeXeac1vUJF_b75SSPEGDPoX0Tv" style="width:100%"></p>

  <p><strong>단순 Tree 모델은 학습이 거의 되지 않는 것을 확인할 수 있다.</strong></p>

  <hr>

  <h3 id="svr--c-kernel-type-degree">2.2.2  SVR : C, kernel type, degree</h3>

  <d-code language="python">
param_grid = {
                'kernel' : ['linear', 'poly', 'rbf', 'sigmoid', ],
                'degree' : [1,2,3,4,5,6],
                'C' : [0.5, 1.0, 2.0, 3.0],
                'epsilon' : [0.1, 0.2, 0.3]
            }
</d-code>

  <p><img src="https://drive.google.com/uc?export=view&amp;id=1raHjdlTfaSxx5b7LWsyHLUNXJsl6_ez6" style="width:100%"></p>

</div>

<hr>

<h2 id="23-error-prediction---target">2.3 Error (prediction - target)</h2>

<div class="spanbox" style="width:100%">

  <h3 id="dt">2.3.1 DT</h3>
  <p><img src="https://drive.google.com/uc?export=view&amp;id=1KGjhEqhIJ_k6uZolp-PXGqMGnLyKtRoa" style="width:49%">
<img src="https://drive.google.com/uc?export=view&amp;id=1MZ1OGvXjHF3U5-LLWZCFA45MB9tYxMlq" style="width:49%"></p>

  <h3 id="svr">2.3.2 SVR</h3>
  <p><img src="https://drive.google.com/uc?export=view&amp;id=1VOgfS065VeZyBa516uOD3rVlzIC9Z4dD" style="width:49%">
<img src="https://drive.google.com/uc?export=view&amp;id=1EawHk8Xyg5aObOJnA1umyzjod0pKBSxl" style="width:49%"></p>

</div>

<hr>

<h2 id="3-학습-데이터-구성">3. 학습 데이터 구성</h2>

<ol>
  <li>
<strong>0값 코드</strong> : 기존 존재하지 않는 코드에 대체할 수 있는 값은 (0, 평균, 중앙값) 등이 있는데, 정도 예측 모델은 모든 코드의 값이 존재하며, 다만 그 값이 0인 경우와 동일하므로 최종적으로 0을 집어넣는 것으로 처리한다.</li>
  <li>
<strong>정규화</strong>: 기존 값 입력을 그대로 사용해야 하므로, 값을 정규화하지 않는다.</li>
  <li>
<strong>이상치 제거</strong>: 물질의 양을 그대로 나타내므로 이상치를 제거하지 않는다.</li>
  <li>예측값: 기존 10000~80000 범위의 값을 1/10000로 줄여서 예측.</li>
</ol>

<div class="spanbox" style="width:100%">
  <h3 id="section-1">3.1 예측값 분포</h3>

  <p><img src="https://drive.google.com/uc?export=view&amp;id=16-ZXy2tI6s72_agj7pzy4PTM7IrcB4hd" style="width:100%"></p>
</div>

<div class="spanbox" style="width:100%">

  <h3 id="section-2">3.2 실제 데이터 분포 / 학습데이터 분포 (0 값 포함)</h3>

  <p><img src="https://drive.google.com/uc?export=view&amp;id=13cSTKqQQ6W4wb1Mx0PcNAWuwJa0wkrvr" style="width:49%">
<img src="https://drive.google.com/uc?export=view&amp;id=1L_JVd1oasKDdVA8s23tNF8AsYndP3SpI" style="width:49%"></p>

</div>

<h2 id="appendix-svr-설명">Appendix: SVR 설명</h2>

<ul>
  <li>$e^{-\gamma (a-b)^2} $</li>
  <li>$\gamma$ 가 클수록, 점들이 가까울수록 더 적은 값으로 된다.</li>
  <li>(a,b) 사이가 멀수록 값이 작다. (가까울수록 크다.)</li>
  <li><a href="https://www.youtube.com/watch?v=Qc5IyLW_hns" target="_blank" rel="noopener noreferrer">video</a></li>
  <li>after modifying the data distribution, the linear support vectors are fitted.</li>
</ul>


      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>


      <hr>
<!--<div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;">
    <script>
      let giscusTheme = localStorage.getItem("theme");
      let giscusAttributes = {
          "src": "https://giscus.app/client.js",
          "data-repo": "fxnnxc/fxnnxc",
          "data-repo-id": "MDEwOlJlcG9zaXRvcnkzMjQ2NjUxMTU=",
          "data-category": "Q&A",
          "data-category-id": "DIC_kwDOE1n_G84CYOk_",
          "data-mapping": "title",
          "data-strict": "0",
          "data-reactions-enabled": "1",
          "data-emit-metadata": "0",
          "data-input-position": "top",
          "data-theme": giscusTheme,
          "data-lang": "en",
          "crossorigin": "anonymous",
          "async": "",
      };
  
  
      let giscusScript = document.createElement("script");
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById("giscus_thread").appendChild(giscusScript);
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript">comments powered by giscus.</a></noscript>
  </div>--><div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;">
    <script>
      let giscusTheme = localStorage.getItem("theme");
      let giscusAttributes = {
          "src": "https://giscus.app/client.js",
          "data-repo": "fxnnxc/fxnnxc",
          "data-repo-id": "MDEwOlJlcG9zaXRvcnkzMjQ2NjUxMTU=",
          "data-category": "Q&A",
          "data-category-id": "DIC_kwDOE1n_G84CYOk_",
          "data-mapping": "title",
          "data-strict": "0",
          "data-reactions-enabled": "1",
          "data-emit-metadata": "0",
          "data-input-position": "top",
          "data-theme": giscusTheme,
          "data-lang": "en",
          "crossorigin": "anonymous",
          "async": "",
      };
  
  
      let giscusScript = document.createElement("script");
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById("giscus_thread").appendChild(giscusScript);
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by giscus.</a>
</noscript>
  </div>
</div>

    <!-- Footer -->    <footer class="sticky-bottom mt-5" style="border: none;border-top:0px">
      <div class="container" style="text-align: center; ">
        © Copyright 2024 Bumjini  . Powered by Jekyll with al-folio theme. Hosted by GitHub Pages.

      </div>
    </footer>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": 0 });
    $("progress-container").css({ "padding-top": 0 });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>

  <d-bibliography src="/assets/bibliography/">
  </d-bibliography>

  <!-- jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="/assets/js/distillpub/overrides.js"></script>

    <center>
        <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;">
    </center>
    <hr> 

</html>
