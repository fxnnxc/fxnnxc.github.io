<!DOCTYPE html>
<!-- _layouts/distill.html -->
<html>
  <head>    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bumjini | [연구 12] Pretrain 방식: [물성심층표현, 원료심층표현]</title>
    <meta name="author" content="Bumjini  " />
    <meta name="description" content="물성심층표현을 활용하여 원료 파이프라인을 간소화한다." />
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🪴</text></svg>">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://fxnnxc.github.io/Pkolmar/kolmar_231226/">
    
    <!-- Dark Mode -->
    


    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams',
        inlineMath: [['$','$'], ['\\(','\\)']]
      },
      chtml: {
          scale: 1.0,
          minScale: .6,  
          mtextFontInherit: true,
          mtextInheritFont: true,
          merrorInheritFont: true,
        },
        svg: {
          scale: 1.2
        }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Distill js -->
    <script src="/assets/js/distillpub/template.v2.js"></script>
    <script src="/assets/js/distillpub/transforms.v2.js"></script>
    
  </head>

  <d-front-matter>
    <script async type="text/json">{
      "title": "[연구 12] Pretrain 방식: [물성심층표현, 원료심층표현]",
      "description": "물성심층표현을 활용하여 원료 파이프라인을 간소화한다.",
      "published": "December 26, 2023",
      "authors": [
        {
          "author": "Bumjin Park",
          "authorURL": "",
          "affiliations": [
            {
              "name": "KAIST",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  <body class="sticky-bottom-footer">

    <!-- Header -->    
    <center>
      <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;">
    </center>
    <hr> 

    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1 style="font-size: 32px;">[연구 12] Pretrain 방식: [물성심층표현, 원료심층표현]</h1>
        <p>물성심층표현을 활용하여 원료 파이프라인을 간소화한다.</p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        

        <ul>
  <li>코드 참조 <a href="https://github.com/fxnnxc/kolmar/tree/v2312.26.1/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A7%8C%EB%93%A4%EA%B8%B0" target="_blank" rel="noopener noreferrer">v23.12.26</a>
</li>
</ul>

<h2 id="이전-내용---원료-표현-학습-전체-파이프-라인">이전 내용 :  원료 표현 학습 전체 파이프 라인</h2>

<p>기존 물성 예측 파이프라인은 다음과 같았다.</p>

<ol>
  <li>기본 원료 표현 : 각 원료의 정보를 제공한다.</li>
  <li>예측용 원료 표현 : 예측 모델을 위해 원료들의 표현이 변화된 상태이다.</li>
  <li>혼합물 표현 : 예측용 원료 표현이 섞여서 혼합물 표현을 만든다.</li>
  <li>예측값 : 혼합물 표현을 바탕으로 예측 모델이 예측한다.</li>
</ol>

<center>
<img src="https://drive.google.com/uc?export=view&amp;id=13j5vScelp23dx07r--IzrfqONH7SV1c2" style="width:100%"> 
</center>

<h2 id="용어-정리">용어 정리</h2>

<ul>
  <li>원료기본표현 : 학습과 무관하게 원료에 대해서 알려진 기본 정보</li>
  <li>원료심층표현 : Mixer 에 들어가는 원료의 표현 벡터</li>
  <li>물성심층표현 : 물성 임무에 대한 표현 (비중, 경도, 점도 등)</li>
  <li>물성예측-혼합물심층표현 : 물성을 예측하기 위해 형성된 혼합물의 표현</li>
</ul>

<h2 id="단순화된-파이프라인">단순화된 파이프라인</h2>

<p>기존 4가지 모델 방식은 예측에 과정을 세분화 하기 위해서 필요하지만, 불필요하게 표현 벡터들이 너무 많아서 사용자와 개발자 입장에서 학습하는 과정이 복잡하다. 원료 예측 파이프라인을 더욱 간단하게 만들기 위해서 이 과정을 2 단계로 줄였고, 이를 위해서 예측 임무 표현 벡터를 활용한다. 기존 4단계는 다음과 같이 구성되며, 각 단계에서 표현벡터와 이를 변환해줄 모델이 필요하다.</p>

<p>기존 방식은 <code class="language-plaintext highlighter-rouge">기본 원료 표현 -&gt; 예측용 표현 -&gt; 혼합물 표현 -&gt; 예측</code> 과정에서 예측 물성마다 표현이 존재해야 하는데, 이는 데이터 수가 굉장히 적은 물성에 대해서는 적합하지 않으며, 학습 모델을 관리하는 게 쉽지 않다.</p>

<center>
<img src="https://drive.google.com/uc?export=view&amp;id=1bjCvfDbKaeWp3ExBSJRC46WC9F37bKHF" style="width:100%"> 
</center>

<p>간소화 된 파이프라인은 <strong>예측용 표현</strong>을 없애고, 임무 표현을 mixer에 같이 넣는 방식이다.</p>
<ul>
  <li>기본 원료 표현 -&gt; 일반화된 표현 + 물성 임무 표현 -&gt; 예측</li>
</ul>

<center>
<img src="https://drive.google.com/uc?export=view&amp;id=1AuVuQ0uGividoWeUN8_iOJqERbOIoQxS" style="width:100%"> 
</center>

<p>새로운 모델의 가정은 원료는 일반적인 표현이 존재하고, 임무 표현이 유의미한 표현을 추출해낸다는 점이다. 기존 방식에서는 임무마다 표현이 존재한다는 가정이었기 때문에 불필요한 표현이 늘어나며, 적은 데이터의 새로운 물성이 나타나면 예측용 표현을 만들기 어려웠다. 따라서, 예측용 표현을 없애고, 물성임무표현이 일반화된 표현으로부터 필요한 정보를 추출해내는 과정으로 설계하였다.</p>

<h3 id="기본-원료-표현">[기본 원료 표현]</h3>

<p>원료의 표현은 두 가지 방식으로 형성된다.</p>
<ol>
  <li>(bottom-up) 기존 알려진 정보 혹은 레이블로부터 도메인 전문가가 설정.</li>
  <li>(top-down) 예측을 위해 학습된 상태로 형성</li>
</ol>

<p>bottom-up 부분이 잘 형성된다면, top-down 으로 학습된 결과도 효과를 본다. 
또한 bottom-up 부분이 제대로 형성된 경우, 새로운 원료에 대해서 bottom 부분의 표현의 유사도를 바탕으로 신규 물질에 대한 표현 벡터를 찾을 수 있다. 따라서, 기본 원료 표현 부분은 모델의 성능과 데이터 수가 적은 원료에 대응할 수 있는 좋은 환경이다.</p>

<h3 id="transformer-mixer">[Transformer Mixer]</h3>

<p>예측 모델에 대해서 요구사항은 다음과 같다.</p>
<ol>
  <li>굉장히 적게 사용되는 원료가 존재한다.</li>
  <li>처방의 조합이 무수히 많이 존재한다. (최대 61개 원료)</li>
  <li>처방에 대해서 예측할 물성이 많이 존재한다.</li>
</ol>

<p>위 가정으로부터 모델을 강건하게 만들기 위해서는 효율적으로 표현공간을 설계할 필요성이 있다. 실제 구현과 학습을 위해서 이를 처리하는 방법은 (1) 일반화된 원료 표현, (2) 맞춤형 물성 임무 표현, (3) 이를 처리해줄 모델을 지니는 구조이다. 혼합물을 처리하는 구조는 트랜스포머 인코더 구조로 self-attention을 사용하여 물성 예측 표현으로부터 Predictor 를 거쳐서 예측한다.</p>

<h2 id="종합-데이터-데이터-구성">종합 데이터 데이터 구성</h2>

<p>비중 (density), 경도 (hardness), pH (ph), 점도 (viscosity) 는 모두 예측할 물성이다. 
처방 - 물성 데이터에서 추출해낼 수 있는 모든 정보를 가지고 <strong>종합된</strong> 데이터셋을 구성한다. 전체 데이터 수는 19000개로, 이는 원료 빈도수로 보정되지 않은 숫자이다. 보정 후에는 수가 줄어든다. 
점도 데이터는 pin 과 rpm 에 대해서는 <code class="language-plaintext highlighter-rouge">4 pin</code> 과 같은 형택로 <code class="language-plaintext highlighter-rouge">pin</code>과 <code class="language-plaintext highlighter-rouge">rpm</code>이  적혀있거나  <code class="language-plaintext highlighter-rouge">rpm * pin</code> 형태로 적힌 데이터로부터 정규표현식을 사용하였다. 
pin과 rpm 조합에 대해서 발견된 개수는 다음과 같다.</p>

<center>
<img src="https://drive.google.com/uc?export=view&amp;id=1gFPBaUUMHinZfYCH5qj3yTzh0OBO6nJG" style="width:60%"> 
</center>

<p>위 표에서 충분히 많은 처방이 존재하는 (pin+rpm) 대해서 각기 다른 레이블을 형성하며, 선택된 pin과 rpm 조합은 다음과 같다. <code class="language-plaintext highlighter-rouge">pin_rpms = [(2, 6), (2,12,), (2,30), (3, 6), (3,12), (4, 6), (7, 12)]</code>. 각 물성에 대한 레이블 정보는 다음과 같다.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">물성</th>
      <th style="text-align: right">처방 수</th>
      <th style="text-align: right">최댓값</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">density (비중)</td>
      <td style="text-align: right">7834</td>
      <td style="text-align: right">1.41</td>
    </tr>
    <tr>
      <td style="text-align: right">hardness  (경도)</td>
      <td style="text-align: right">2422</td>
      <td style="text-align: right">1,200</td>
    </tr>
    <tr>
      <td style="text-align: right">pH</td>
      <td style="text-align: right">7435</td>
      <td style="text-align: right">10.1</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 2*6</td>
      <td style="text-align: right">75</td>
      <td style="text-align: right">4,000</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 2*12</td>
      <td style="text-align: right">96</td>
      <td style="text-align: right">2,000</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 2*30</td>
      <td style="text-align: right">114</td>
      <td style="text-align: right">750</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 3*6</td>
      <td style="text-align: right">49</td>
      <td style="text-align: right">15,000</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 3*12</td>
      <td style="text-align: right">234</td>
      <td style="text-align: right">7,500</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 4*6</td>
      <td style="text-align: right">547</td>
      <td style="text-align: right">80,000</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 7*12</td>
      <td style="text-align: right">367</td>
      <td style="text-align: right">115,000</td>
    </tr>
  </tbody>
</table>

<h2 id="빈도수로-자르기">빈도수로 자르기</h2>

<p>이전에 논의한 순차적 원료표현학습을 위해 충분히 많이 사용된 원료들을 포함한 처방을 선택할 경우, 데이터 수는 줄어들 게 된다. 
해당 그림은 이전 점도 데이터에 대한 예시이며, 종합에 대한 정보가 데이터가 아니다.</p>
<center>
<img src="https://drive.google.com/uc?export=view&amp;id=1Z7Sq4SqGj3YEJj-ev3jacCzXxNBB_P-Z" style="width:80%;padding:10px"> 
</center>

<p>실제로 종합데이터에 대해서 빈도수 이상 원료와 이를 포함하는 처방을 선택하면 다음과 같다. 
예시는 2번 이상 나오는 원료들을 모두 포함한 처방을 고른 경우이다.</p>

<p>2번 이상 나타나는 원료로 구성된 처방</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">물성</th>
      <th style="text-align: right">비율</th>
      <th style="text-align: right">포함 수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">density (비중)</td>
      <td style="text-align: right">0.87</td>
      <td style="text-align: right">6818</td>
    </tr>
    <tr>
      <td style="text-align: right">hardness  (경도)</td>
      <td style="text-align: right">0.72</td>
      <td style="text-align: right">1768</td>
    </tr>
    <tr>
      <td style="text-align: right">pH</td>
      <td style="text-align: right">0.86</td>
      <td style="text-align: right">6445</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 2*6</td>
      <td style="text-align: right">0.2</td>
      <td style="text-align: right">14</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 2*12</td>
      <td style="text-align: right">0.20</td>
      <td style="text-align: right">20</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 2*30</td>
      <td style="text-align: right">0.30</td>
      <td style="text-align: right">35</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 3*6</td>
      <td style="text-align: right">0.16</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 3*12</td>
      <td style="text-align: right">0.29</td>
      <td style="text-align: right">70</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 4*6</td>
      <td style="text-align: right">0.70</td>
      <td style="text-align: right">384</td>
    </tr>
    <tr>
      <td style="text-align: right">viscosity 7*12</td>
      <td style="text-align: right">0.73</td>
      <td style="text-align: right">269</td>
    </tr>
  </tbody>
</table>

      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>


      <hr>
<!--<div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;">
    <script>
      let giscusTheme = localStorage.getItem("theme");
      let giscusAttributes = {
          "src": "https://giscus.app/client.js",
          "data-repo": "fxnnxc/fxnnxc",
          "data-repo-id": "MDEwOlJlcG9zaXRvcnkzMjQ2NjUxMTU=",
          "data-category": "Q&A",
          "data-category-id": "DIC_kwDOE1n_G84CYOk_",
          "data-mapping": "title",
          "data-strict": "0",
          "data-reactions-enabled": "1",
          "data-emit-metadata": "0",
          "data-input-position": "top",
          "data-theme": giscusTheme,
          "data-lang": "en",
          "crossorigin": "anonymous",
          "async": "",
      };
  
  
      let giscusScript = document.createElement("script");
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById("giscus_thread").appendChild(giscusScript);
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript">comments powered by giscus.</a></noscript>
  </div>--><div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;">
    <script>
      let giscusTheme = localStorage.getItem("theme");
      let giscusAttributes = {
          "src": "https://giscus.app/client.js",
          "data-repo": "fxnnxc/fxnnxc",
          "data-repo-id": "MDEwOlJlcG9zaXRvcnkzMjQ2NjUxMTU=",
          "data-category": "Q&A",
          "data-category-id": "DIC_kwDOE1n_G84CYOk_",
          "data-mapping": "title",
          "data-strict": "0",
          "data-reactions-enabled": "1",
          "data-emit-metadata": "0",
          "data-input-position": "top",
          "data-theme": giscusTheme,
          "data-lang": "en",
          "crossorigin": "anonymous",
          "async": "",
      };
  
  
      let giscusScript = document.createElement("script");
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById("giscus_thread").appendChild(giscusScript);
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by giscus.</a>
</noscript>
  </div>
</div>

    <!-- Footer -->    <footer class="sticky-bottom mt-5" style="border: none;border-top:0px">
      <div class="container" style="text-align: center; ">
        © Copyright 2024 Bumjini  . Powered by Jekyll with al-folio theme. Hosted by GitHub Pages.

      </div>
    </footer>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": 0 });
    $("progress-container").css({ "padding-top": 0 });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>

  <d-bibliography src="/assets/bibliography/">
  </d-bibliography>

  <!-- jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="/assets/js/distillpub/overrides.js"></script>

    <center>
        <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;">
    </center>
    <hr> 

</html>
