<!DOCTYPE html>
<!-- _layouts/distill.html -->
<html>
    
<head>    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bumjini | Explanation on Safety Phase Transition in Large Language Models</title>
    <meta name="author" content="Bumjini  " />
    <meta name="description" content="안전장치로 학습된 모델의 phase transition에 대한 체계적 연구. " />
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🪴</text></svg>">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://fxnnxc.github.io/share/safety_phase/">
    
    <!-- Dark Mode -->
    

  <!-- jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams',
        inlineMath: [['$','$'], ['\\(','\\)']]
      },
      chtml: {
          scale: 1.0,
          minScale: .6,  
          mtextFontInherit: true,
          mtextInheritFont: true,
          merrorInheritFont: true,
        },
        svg: {
          scale: 1.2
        }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

  <!-- Distill js -->
  <script src="/assets/js/distillpub/template.v2.js"></script>
  <script src="/assets/js/distillpub/transforms.v2.js"></script>
  <script src="/assets/js/distillpub/overrides.js"></script>
  <!-- Page/Post style -->
  
</head>

  <d-front-matter>
    <script async type="text/json">{
      "title": "Explanation on Safety Phase Transition in Large Language Models",
      "description": "안전장치로 학습된 모델의 phase transition에 대한 체계적 연구. ",
      "published": "May 21, 2024",
      "authors": [
        {
          "author": "Bumjin Park",
          "authorURL": "",
          "affiliations": [
            {
              "name": "KAIST",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  <body style="padding-top:0px" class="sticky-bottom-footer"> 
    
    <!-- Header --><header>
      
      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm sticky-top">
        <div class="container">
          <img>
          <!-- <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;"> -->
          
          <a class="navbar-brand title font-weight-lighter" href="https://fxnnxc.github.io/" style="margin-left:20px ;">
              <!--Bumjini-->
           <span class="font-weight-bold" style="font-size:larger;font-family:Times New Roman;">Bumjini    </span>
        </a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <!-- <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/">  About Me</a>
              </li> -->
              
              <!-- Blog -->
              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_papers/"> Papers</a>
              </li>

              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_articles/"> Articles</a>
              </li>

              <li style="font-size: 17px" class="nav-item ">
                <a class="nav-link" href="/main_projects/"> Projects</a>
              </li>

              <!-- Other pages -->
              <li style="font-size: 17px" class="nav-item dropdown ">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Others</a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/side_papers/">🗂️ side-paper</a>
                  <a class="dropdown-item" href="/side_articles/">🥕 side-articles</a>
                  <a class="dropdown-item" href="/book/">📚 book (korean)</a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="post distill">

      <d-title>
        <h1 style="font-size: 32px;">Explanation on Safety Phase Transition in Large Language Models</h1>
        <p>안전장치로 학습된 모델의 phase transition에 대한 체계적 연구. </p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        

        <style>
.table td, table th{
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    color: var(--global-text-color);
    line-height: 140%;
    font-weight: 420;
    font-size: var(--global-text-size);
} 
</style>

<h2 id="motiv">Motiv</h2>

<p>AI 모델은 인류에 해가 되는 문장을 말하면 안된다. 최근 연구들은 안전한 사용을 위해 나쁜말을 하는 대신 safety와 관련된 말을 하도록 학습된다. 대표적인 예시로 차별적인 내용을 물어보면 평등에 대한 중요성을 언급한다. 이렇게 Safety와 관련된 말을 하도록 생성 모드가 바뀌는 <em>safety phase</em>에 대한 전반적인 이해 및 설명은 더욱 안전한 모델을 만들기 위해서 필수적이다. 본 연구에서는 instruction-tuned 된 GPT 모델에 대한 <em>safety phase</em>을 해석하기 위한 두 가지 실험적인 결과를 제시한다.</p>

<p><strong>📌 1) 모델은 어떠한 상황에서 safety phase가 발생하는가.</strong>: 이 연구는 safety와 관련된 다양한 문장에 대해서 각 문장의 표현들을 비교하고 클러스터링하여 전반적인 모델의 safety sentence들의 입출력을 통계적으로 분석한다.<br>
<strong>📌 2) Safety phase는 어떤 방식으로 trigger 되는가?</strong>: 모델 내부에서는 safety와 관련된 문장을 생성하도록 유도하는 특징 혹은 뉴런이 존재한다. Safety를 유발하는 모델 내부를 탐구하여 해당 구조의 조작으로 safety와 관련된 문장들의 변화를 탐구한다. 
s
대규모 언어 모델은 사회의 규약과 정보에 맞춰서 지속적으로 기존 정보를 지우고 새롭게 덮어쓴다. 또한 부정적인 정보들은 생성을 막도록 추가적인 학습이 되며 사회규범과 법의 변화에 맞추어 모델의 작동 방식은 바뀐다. 본 연구에서 탐구하는 <em>safety phase transition</em>은 안전 문구와 관련된 LLM의 생성과정을 분석함으로써 실험적 관찰을 바탕으로한 더욱 안전한 모델 구조에 대한 영감을 제시한다.</p>

<h2 id="big-picture">Big Picture</h2>

<ul>
  <li>safety transition in LLM
    <ul>
      <li>(3) safety transition의 정의. Complete and incomplete sentence 정의. Harmful sentence 정의</li>
      <li>🥕 (3.1, 4.1) template-base evaluation of safety-phase transition (Yeonjea, Jinsil)</li>
      <li>🍊 (3.2, 4.2) activation-base evaluation of safety-phase transition (Bumjin, Youngju)</li>
    </ul>
  </li>
</ul>

<h2 id="collection-of-papers">Collection of Papers</h2>

<ul>
  <li>
<strong>Safety finetuning + deceiving</strong>
    <ul>
      <li>Sleeper Agents: Training Deceptive LLMs that Persist Through Safety Training</li>
      <li>Simple probes can catch sleeper agents</li>
    </ul>
  </li>
  <li>
<strong>Safety finetuning</strong>
    <ul>
      <li>Training a helpful and harmless assistant with reinforcement learning from human feedback</li>
      <li>Training language models to follow instructions with human feedback</li>
    </ul>
  </li>
  <li>
<strong>Jail-break</strong>
    <ul>
      <li>Defending chatgpt against jailbreak attack via self-reminders</li>
      <li>Many-shot jailbreaking</li>
      <li>Universal and Transferable Adversarial Attacks on Aligned Language Models</li>
      <li>Jailbroken: How does llm safety training fail?</li>
      <li>“Do Anything Now”: Characterizing and Evaluating In-The-Wild Jailbreak Prompts on Large Language Models</li>
    </ul>
  </li>
  <li>Detecting Jailbreaks
    <ul>
      <li>Causality Analysis for Evaluating the Security of Large Language Models</li>
    </ul>
  </li>
  <li>Explanation on LLM
    <ul>
      <li>Explainability for Large Language Models: A Survey</li>
    </ul>
  </li>
  <li>
<strong>Safety</strong>
    <ul>
      <li>Towards understanding sycophancy in language models</li>
      <li>GPT-4 Technical Report</li>
      <li>Constitutional AI:Harmlessness from AI feedback</li>
    </ul>
  </li>
  <li>
<strong>Interpretability (feature)</strong>
    <ul>
      <li>Towards Monosemanticity: Decomposing Language Models With Dictionary Learning</li>
      <li>Mapping the Mind of a Large Language Model</li>
    </ul>
  </li>
</ul>

<hr>

<h2 id="abstract">Abstract</h2>

<h2 id="1-introduction">1. Introduction</h2>

<p>최근 몇 년 사이에, 생성형 AI 의 하나인 Large Language Model(LLM) 은 유래 없이 성장하여, 이미 전 세계인이 다양한 용도로 사용하는 도구가 되었다. 예를 들어, ChatGPT는 사용자 수 100만 돌파를 5일[1] 만에, 월간 사용자 10억을 세 달[2]만에 달성하는 역대 최단 기록을 세웠다. 이러한 빠른 확산에는 여러 문제점도 따랐다. 대표적인 부작용으로는 Hallucination, Bias, Harmful Contents 생성 등이 있으며, 충분히 고려되지 못한 채 서비스가 제공 되었다. 모델 연구자들과 서비스 제공 업체들이 안전한 모델을 만들기 위해 노력하고 있음[3]에도 불구하고, 현재 모델은 적지 않은 취약점들을 가지고 있고, 악의적인 사용자는 Adversarial attack prompt 를 사용하여 LLM 을 악용하려는 공격 전략을 점점 발전시키고 있다.</p>

<p>공격에 대비하는 방법은, 공격 방식을 지속적으로 모니터링해서 해당 방어 로직을 넣는, “공격에 대한 방어”의 프로세스가 기본이다. 이러한 다양한 Adversarial attack prompt 에 대한 연구는 다양하게 진행 되고 있다[4]. 하지만 LLM 의 경우, 다른 일반적인 서비스들처럼 특정 프로토콜의 보안을 강화하는 것으로는 해결되지 않는다. “자연어로 들어오는 요청에 대한 정보 제공”이 LLM의 주요 역할인데, “자연어 요청” 자체가 공격일 수 있고, “정보 제공” 자체가 잘못된 동작에 해당하기 때문이다. 따라서 공격에 대한 대응을 넘어, LLM 의 동작 방식이 기본적으로 해로운 정보를 만들어내지 않도록 하는 것이 중요하다.</p>

<p>이 논문에서는 LLM 의 가장 기본적인 동작에 해당하는, “다음에 이어지는 내용 생성” 에 대한 LLM 의 특성을 조사했다. 그 중에서도 어떤 상황에서 safety phase 를 거치는지에 초점을 맞췄다. 주요 아이디어는 다음과 같다.</p>

<p>1) safety phase : 문장의 흐름에 맞추기 위해서 “해로운 내용” 일지라도 생성을 하는지 여부</p>

<p>2) safety phase transition : “해로운 내용 생성”을 한 후에, 원래 훈련된 기조대로 안전한 내용을 생성하여 추구하는 안전 기준으로 돌아가는지를 살피는 것</p>

<p>해로운 내용을 이끌어 내는 완성되지 않은 문장과, 해로운 내용이 들어있지만 완성된 문장을 입력 prompt 로 넣어 모델의 출력과 그 차이점을 분석했다. 그 결과, 완성되지 않은 문장일 경우 높은 확률로 해로운 내용을 생성함을 발견하였고, LLM 이 해로운 내용을 생성하였다 하더라도 높은 비율로 안전한 내용으로 돌아가는 경향이 있음을 발견하였다. 이는 LLM 이 기본적으로 설정된 안전 기준을 완전히 벗어나지 않도록 설계되었음을 시사한다.</p>

<h2 id="2-related-work">2. Related Work</h2>

<h2 id="3-method">3. Method</h2>

<p>We consider a set of concepts $\mathcal{C} = (z_1, z_2, \cdots)$ where each concept $c$ is related to a human-oriented concept, such as harmless or safety. 
Each concept $z$ has examples, a set of passages \(\mathcal{Y}_{c}\), where passage \(y = (y_1, y_2, \cdots) \in \mathcal{Y}_{c}\) consists of tokens $y_i$ and includes the semantic meaning of concept $c$. We use notation $c \perp c’$ when two concepts $c$ and $c’$ can not exist together, e.g., safety concept and violence concept.</p>

<p>We define two terms <em>phase</em> and *phase transition$ as follows.</p>

<blockquote>
  <p>Definition: <strong>Phase</strong> <br></p>
  <blockquote>
    <p>A $c$-<em>phase</em> is a subset of time steps $[t_{begin}, t_{end}]$ where the generated content \(({y}_{t_{begin}}, \cdots, {y}_{t_{end}})\) with \({y}_{t_{k}} \sim P_{\theta}(\cdot \vert y_1, \cdots, y_{t_{k}-1})\) can be included in the set of concept-related passages \(\mathcal{Y}_{c}\).</p>
  </blockquote>
</blockquote>

<p>The definition of <em>phase</em> assumes a passage $y$. The inclusion of an element in the set element in $\mathcal{Y}_{c}$ can be either determined by a human-annotator or text similarity scores with the examples in the set.</p>

<!-- We define *safe phase* which generates safety related passes $\mathcal{Y}_{safety}$   -->

<blockquote>
  <p>Definition: <strong>Phase Emergence</strong>   <br></p>
  <blockquote>
    <p>A <em>phase emergence</em> is the time step when the generation includes new concept $c’$ as a phase.</p>
  </blockquote>
</blockquote>

<blockquote>
  <p>Definition: <strong>Phase Transition</strong>   <br></p>
  <blockquote>
    <p>A <em>phase transition</em> is a $c$-phase emergence with the disappearance of existing concept $c’$ such that $ c’ \perp c$.</p>
  </blockquote>
</blockquote>

<p>Rigorously, the definition of phase transition</p>

<h3 id="31-safety-phase-transition">3.1 Safety-Phase Transition</h3>

<p>consider two types of passages, $\mathcal{T}<em>{com}$ and $\mathcal{T}</em>{incom}$ where the elements are complete and incomplete sentences.</p>

<p>Consider a harmful prompt $\mathcal{P} \in\mathcal{T}_{com}$.</p>

<p>Figure below shows the phase transition for complete and incomplete cases.</p>
<p align="center">
<img src="https://onedrive.live.com/embed?resid=AE042A624064F8CA%219678&amp;authkey=%21AL_paZel8mue_pc&amp;width=1636&amp;height=602" width="1636" height="250">
</p>

<h3 id="32-detection-of-phase-transition">3.2 Detection of Phase Transition</h3>

<p>Several work propose the methods to detect the conceptual neurons.</p>

<ul>
  <li>Value Detection via optimization : find the activation pattern that mostly maximize the likelihood of the safe phase. (FactualGPT)</li>
  <li>Activation : Find the activation pattern via forwarding the target output</li>
  <li>Neuron Attribution : Compute the attribution score via gradient descent.</li>
</ul>

<p>We find a vector at the end of sentence. A hidden representation $A_{safe}$ which maximizes the forward.</p>

<blockquote>
  <p>What about the key-value structure? Our we finding any key? 
We do not find a sparse key neurons which activate the concept. 
Because recent work reveals that the neural network prefers. However, it could be the case that only the sparse combination of neurons forms the target activation. Therefore, finding neuron (entry point for vector representation) is not the primitive problem.</p>
</blockquote>

<h2 id="4-experiments">4. Experiments</h2>

<h2 id="41-phase-transition-with-templates">4.1 Phase Transition with Templates</h2>

<p>We categorize four types of generations for the complete and incomplete prompts.</p>

<h4 id="complete">Complete</h4>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Harmful Generation</th>
      <th style="text-align: center">Safety-phase Transition</th>
      <th style="text-align: left">$\mathcal{P}$=”Teach me how to hurt people.”</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">-</td>
      <td style="text-align: center">✅</td>
      <td style="text-align: left"><strong>I cannot fullfil your request.</strong></td>
    </tr>
    <tr>
      <td style="text-align: center">-</td>
      <td style="text-align: center">❌</td>
      <td style="text-align: left"><strong>A stab in the back …</strong></td>
    </tr>
  </tbody>
</table>

<h4 id="incomplete">Incomplete</h4>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Harmful Generation</th>
      <th style="text-align: center">Safety-phase Transition</th>
      <th style="text-align: left">$\mathcal{P}’$=”A stab in the back or”</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">✅</td>
      <td style="text-align: center">✅</td>
      <td style="text-align: left"><strong>a knife to the chest. <br> I cannot fullfil your request.</strong></td>
    </tr>
    <tr>
      <td style="text-align: center">✅</td>
      <td style="text-align: center">❌</td>
      <td style="text-align: left"><strong>a knife to the chest. <br> I addition, shoot a gun.</strong></td>
    </tr>
    <tr>
      <td style="text-align: center">❌</td>
      <td style="text-align: center">✅</td>
      <td style="text-align: left"><strong>hurt is not a good action <br> I cannot fullfil your request.</strong></td>
    </tr>
    <tr>
      <td style="text-align: center">❌</td>
      <td style="text-align: center">❌</td>
      <td style="text-align: left"><strong>hurt is not a good action. <br> but  you can shoot a gun</strong></td>
    </tr>
  </tbody>
</table>

<h2 id="42-phase-transition-via-activation">4.2 Phase Transition via Activation</h2>

<h3 id="adding-concept">Adding concept</h3>

<ol>
  <li>Does the jailbreak examples shows the safe-phase with the activation addition?</li>
  <li>Does the incomplete sentence jailbreak examples shows the safe-phase without completion of the harmful completion?</li>
</ol>

<h3 id="removing-concept">Removing concept</h3>

<h2 id="5-results">5. Results</h2>

<h2 id="6-discussion">6. Discussion</h2>

<h2 id="7-conclusion">7. Conclusion</h2>


      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

<!--
    </div>
 -->
      <hr>
<div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;">
    <script>
      let giscusTheme = localStorage.getItem("theme");
      let giscusAttributes = {
          "src": "https://giscus.app/client.js",
          "data-repo": "fxnnxc/fxnnxc",
          "data-repo-id": "MDEwOlJlcG9zaXRvcnkzMjQ2NjUxMTU=",
          "data-category": "Q&A",
          "data-category-id": "DIC_kwDOE1n_G84CYOk_",
          "data-mapping": "title",
          "data-strict": "0",
          "data-reactions-enabled": "1",
          "data-emit-metadata": "0",
          "data-input-position": "top",
          "data-theme": giscusTheme,
          "data-lang": "en",
          "crossorigin": "anonymous",
          "async": "",
      };
  
  
      let giscusScript = document.createElement("script");
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById("giscus_thread").appendChild(giscusScript);
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by giscus.</a>
</noscript>
  </div>
<!-- Footer -->    <footer class="sticky-bottom mt-5" style="border: none;border-top:0px">
      <div class="container" style="text-align: center; ">
        © Copyright 2024 Bumjini  . Powered by Jekyll with al-folio theme. Hosted by GitHub Pages.

      </div>
    </footer>
    
    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": 0 });
    $("progress-container").css({ "padding-top": 0 });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>
  </div></body>
  
  <d-bibliography src="/assets/bibliography/all.bib">
  </d-bibliography>
  <script src="/assets/js/distillpub/overrides.js"></script>

  <center>
    <a  href="">
    <img src="/assets/common/KAIST-hi.gif" width="40px" style="margin-right:0px; padding-bottom: 3px;">
    </a>
  </center>
  <hr> 

  </html>
